<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Roblox Bacon Update</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; background: #1B1D1F; color: white; }
        #menu { position: absolute; width: 100%; height: 100%; background: #1B1D1F; display: flex; flex-direction: column; align-items: center; z-index: 200; }
        .header { width: 100%; padding: 20px; background: #2B2D2F; text-align: center; font-size: 24px; font-weight: bold; border-bottom: 2px solid #00A2FF; }
        .game-grid { display: flex; gap: 20px; margin-top: 50px; }
        .card { width: 220px; background: #2B2D2F; border-radius: 10px; cursor: pointer; border: 1px solid #444; transition: 0.2s; }
        .card:hover { transform: scale(1.05); border-color: #00A2FF; }
        .thumb { width: 100%; height: 120px; border-radius: 10px 10px 0 0; }
        .sel-box { margin: 20px; display: flex; gap: 10px; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #393B3D; color: white; font-weight: bold; }
        button.active { background: #00A2FF; }
        #esc-menu { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:300; }
    </style>
</head>
<body>

<div id="menu">
    <div class="header">ROBLOX STUDIO</div>
    <div class="sel-box">
        <button id="b-boy" class="active" onclick="setAvatar('boy')">Bacon Boy</button>
        <button id="b-girl" onclick="setAvatar('girl')">Bacon Girl</button>
    </div>
    <div class="game-grid">
        <div class="card" onclick="start('base')">
            <div class="thumb" style="background: linear-gradient(to bottom, #11998e, #38ef7d);"></div>
            <div style="padding:10px"><b>Grass Obby</b></div>
        </div>
        <div class="card" onclick="start('lava')">
            <div class="thumb" style="background: linear-gradient(to bottom, #ff416c, #ff4b2b);"></div>
            <div style="padding:10px"><b>Lava Rise</b></div>
        </div>
    </div>
</div>

<div id="esc-menu">
    <div style="background:#2B2D2F; padding:30px; border-radius:10px; display:flex; flex-direction:column; gap:10px;">
        <button style="background:#555" onclick="toggleEsc()">Resume</button>
        <button style="background:#F64141" onclick="resetChar()">Reset Character</button>
        <button style="background:#00A2FF" onclick="location.reload()">Leave</button>
    </div>
</div>

<script type="importmap">
  { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
</script>

<script type="module">
    import * as THREE from 'three';

    let scene, camera, renderer, player, parts = {};
    let blocks = [], gender = 'boy', active = false, esc = false, dead = false;
    let vY = 0, jump = false, walk = 0;
    const keys = {};

    window.setAvatar = (g) => {
        gender = g;
        document.getElementById('b-boy').className = g==='boy'?'active':'';
        document.getElementById('b-girl').className = g==='girl'?'active':'';
    };

    window.start = (type) => {
        document.getElementById('menu').style.display = 'none';
        active = true;
        init(type);
    };

    window.toggleEsc = () => { if(active && !dead) { esc = !esc; document.getElementById('esc-menu').style.display = esc?'flex':'none'; } };
    window.resetChar = () => { if(!dead) die(); toggleEsc(); };

    function die() {
        dead = true;
        Object.values(parts).forEach(p => {
            p.userData.v = new THREE.Vector3((Math.random()-0.5)*0.3, Math.random()*0.3, (Math.random()-0.5)*0.3);
            p.userData.rot = new THREE.Vector3(Math.random()*0.2, Math.random()*0.2, Math.random()*0.2);
        });
        setTimeout(respawn, 2000);
    }

    function respawn() {
        player.position.set(0, 5, 0);
        vY = 0; dead = false;
        Object.values(parts).forEach(p => {
            p.position.copy(p.userData.orig);
            p.rotation.set(0,0,0);
        });
    }

    function init(type) {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const sun = new THREE.DirectionalLight(0xffffff, 0.6);
        sun.position.set(10, 20, 10);
        scene.add(sun);

        const floor = new THREE.Mesh(new THREE.PlaneGeometry(300, 300), new THREE.MeshPhongMaterial({color: 0x3a8e3a}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        const addBlock = (x,y,z,w,h,d,c,lava=false) => {
            const b = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshPhongMaterial({color:c}));
            b.position.set(x,y,z);
            scene.add(b);
            if(lava) b.userData.isLava = true;
            blocks.push(b);
        };

        if(type === 'base') {
            for(let i=1; i<6; i++) addBlock(0, i, -i*10, 6, 0.5, 6, 0xcccccc);
            addBlock(0, 0.1, -25, 15, 0.2, 10, 0xff0000, true);
        } else {
            for(let i=1; i<15; i++) addBlock(Math.sin(i)*5, i, -i*8, 4, 0.5, 4, i%3===0?0xff0000:0x555555, i%3===0);
        }

        player = new THREE.Group();
        const skin = gender === 'boy' ? 0xffff00 : 0xffdbac;
        const shirt = gender === 'boy' ? 0x0000ff : 0xff69b4;

        const mk = (w,h,d,c,x,y,z,n) => {
            const m = new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshPhongMaterial({color:c}));
            m.position.set(x,y,z); m.userData.orig = new THREE.Vector3(x,y,z);
            player.add(m); parts[n] = m; return m;
        };

        mk(1, 1.2, 0.6, shirt, 0, 1.2, 0, 'torso');
        mk(0.7, 0.7, 0.7, skin, 0, 2.15, 0, 'head');
        mk(0.4, 1, 0.4, skin, -0.75, 1.3, 0, 'armL');
        mk(0.4, 1, 0.4, skin, 0.75, 1.3, 0, 'armR');
        mk(0.45, 1, 0.45, 0x333333, -0.25, 0.5, 0, 'legL');
        mk(0.45, 1, 0.45, 0x333333, 0.25, 0.5, 0, 'legR');

        // BACON HAIR
        const hairColor = 0x4B2C20;
        for(let i=0; i<3; i++) {
            const b = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.15, 0.2), new THREE.MeshPhongMaterial({color: hairColor}));
            b.position.set(0, 2.5 + (i*0.1), -0.1 + (i*0.1));
            parts.head.add(b);
        }

        scene.add(player);
        window.addEventListener('keydown', e => { if(e.code==='Escape') toggleEsc(); keys[e.code]=true; });
        window.addEventListener('keyup', e => keys[e.code]=false);
        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        if(!active) return;

        if(dead) {
            Object.values(parts).forEach(p => {
                p.position.add(p.userData.v);
                p.rotation.x += p.userData.rot.x;
            });
        } else if(!esc) {
            let mX = 0, mZ = 0;
            if(keys['KeyW']) mZ -= 1; if(keys['KeyS']) mZ += 1;
            if(keys['KeyA']) mX -= 1; if(keys['KeyD']) mX += 1;

            if(mX !== 0 || mZ !== 0) {
                const dir = new THREE.Vector3(mX, 0, mZ).normalize();
                player.position.addScaledVector(dir, 0.15);
                player.rotation.y = THREE.MathUtils.lerp(player.rotation.y, Math.atan2(mX, mZ), 0.1);
                walk += 0.2;
                parts.legL.rotation.x = Math.sin(walk)*0.7; parts.legR.rotation.x = -Math.sin(walk)*0.7;
                parts.armL.rotation.x = -Math.sin(walk)*0.5; parts.armR.rotation.x = Math.sin(walk)*0.5;
            } else {
                ['legL','legR','armL','armR'].forEach(k => parts[k].rotation.x = 0);
            }

            if(keys['Space'] && !jump) { vY = 0.25; jump = true; }
            player.position.y += vY; vY -= 0.012;

            if(player.position.y < 0) { player.position.y = 0; vY = 0; jump = false; }

            blocks.forEach(b => {
                const dx = Math.abs(player.position.x - b.position.x);
                const dz = Math.abs(player.position.z - b.position.z);
                const dy = player.position.y - (b.position.y + 0.25);
                if(dx < (b.geometry.parameters.width/2 + 0.3) && dz < (b.geometry.parameters.depth/2 + 0.3)) {
                    if(b.userData.isLava) die();
                    else if(vY <= 0 && dy > -0.5 && dy < 0.5) {
                        player.position.y = b.position.y + 0.75 + (b.geometry.parameters.height/2);
                        vY = 0; jump = false;
                    }
                }
            });
        }

        camera.position.lerp(new THREE.Vector3(player.position.x, player.position.y+8, player.position.z+15), 0.1);
        camera.lookAt(player.position);
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
