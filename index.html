<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Roblox v3 - Twarz, Skok i Płynność</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #87CEEB; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 15px; font-family: sans-serif; pointer-events: none; border-radius: 10px; }
    </style>
</head>
<body>
<div id="ui">
    <b>ROBLOX CLONE</b><br>
    WASD - Ruch | Spacja - SKOK<br>
    Myszka (trzymaj LPM) - Obracanie
</div>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
    }
  }
</script>

<script type="module">
    import * as THREE from 'three';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.AmbientLight(0xffffff, 1);
    scene.add(light);

    // PODŁOGA
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshPhongMaterial({ color: 0x3a8e3a }));
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // --- GRACZ ---
    const player = new THREE.Group();
    const yellowMat = new THREE.MeshPhongMaterial({color: 0xffff00});
    const blueMat = new THREE.MeshPhongMaterial({color: 0x0000ff});
    const greenMat = new THREE.MeshPhongMaterial({color: 0x00ff00});
    const blackMat = new THREE.MeshPhongMaterial({color: 0x000000});

    const torso = new THREE.Mesh(new THREE.BoxGeometry(1, 1.2, 0.6), blueMat);
    torso.position.y = 1.2;
    player.add(torso);

    const head = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.7, 0.7), yellowMat);
    head.position.y = 2.15;
    player.add(head);

    // TWARZ (OCZY I UŚMIECH)
    const eyeL = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.1), blackMat);
    eyeL.position.set(-0.2, 2.25, 0.35);
    player.add(eyeL);
    const eyeR = eyeL.clone();
    eyeR.position.x = 0.2;
    player.add(eyeR);

    const mouth = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.05, 0.1), blackMat);
    mouth.position.set(0, 2.05, 0.35);
    player.add(mouth);

    const armGeo = new THREE.BoxGeometry(0.4, 1, 0.4);
    const armL = new THREE.Mesh(armGeo, yellowMat);
    armL.position.set(-0.75, 1.3, 0);
    player.add(armL);
    const armR = armL.clone();
    armR.position.set(0.75, 1.3, 0);
    player.add(armR);

    const legL = new THREE.Mesh(new THREE.BoxGeometry(0.45, 1, 0.45), greenMat);
    legL.position.set(-0.25, 0.5, 0);
    player.add(legL);
    const legR = legL.clone();
    legR.position.set(0.25, 0.5, 0);
    player.add(legR);

    scene.add(player);

    // --- LOGIKA I FIZYKA ---
    let cameraAngle = 0;
    let cameraDistance = 12;
    let isMouseDown = false;
    let velocityY = 0;
    let isJumping = false;

    document.addEventListener('mousedown', () => isMouseDown = true);
    document.addEventListener('mouseup', () => isMouseDown = false);
    document.addEventListener('mousemove', (e) => { if (isMouseDown) cameraAngle -= e.movementX * 0.01; });

    const keys = {};
    window.onkeydown = (e) => { 
        keys[e.code] = true; 
        if(e.code === 'Space' && !isJumping) {
            velocityY = 0.25; 
            isJumping = true;
        }
    };
    window.onkeyup = (e) => keys[e.code] = false;

    let walkTime = 0;

    function animate() {
        requestAnimationFrame(animate);
        const moveDir = new THREE.Vector3();
        let moving = false;

        if (keys['KeyW']) { moveDir.z = -1; moving = true; }
        if (keys['KeyS']) { moveDir.z = 1; moving = true; }
        if (keys['KeyA']) { moveDir.x = -1; moving = true; }
        if (keys['KeyD']) { moveDir.x = 1; moving = true; }

        if (moving) {
            moveDir.normalize().applyAxisAngle(new THREE.Vector3(0, 1, 0), cameraAngle);
            player.position.addScaledVector(moveDir, 0.15);
            player.rotation.y = Math.atan2(moveDir.x, moveDir.z);

            walkTime += 0.2;
            armL.rotation.x = -Math.sin(walkTime) * 0.7;
            armR.rotation.x = Math.sin(walkTime) * 0.7;
            legL.rotation.x = Math.sin(walkTime) * 0.7;
            legR.rotation.x = -Math.sin(walkTime) * 0.7;
        } else {
            armL.rotation.x = armR.rotation.x = legL.rotation.x = legR.rotation.x = 0;
        }

        // FIZYKA SKOKU
        player.position.y += velocityY;
        if (player.position.y > 0) {
            velocityY -= 0.012; // Grawitacja
        } else {
            player.position.y = 0;
            velocityY = 0;
            isJumping = false;
        }

        // KAMERA
        camera.position.set(
            player.position.x + Math.sin(cameraAngle) * cameraDistance,
            player.position.y + 5,
            player.position.z + Math.cos(cameraAngle) * cameraDistance
        );
        camera.lookAt(player.position.x, player.position.y + 1.5, player.position.z);

        renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
