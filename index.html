<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Roblox z Systemem Menu ESC</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #232527; }
        
        /* G≈Å√ìWNE MENU ROBOLX */
        #main-menu {
            position: absolute; width: 100%; height: 100%;
            background: #1B1D1F; display: flex; flex-direction: column; align-items: center; z-index: 200;
        }
        .header { width: 100%; padding: 20px; background: #2B2D2F; color: white; font-size: 24px; font-weight: bold; text-align: center; }
        .game-card { width: 280px; background: #393B3D; border-radius: 10px; margin-top: 50px; cursor: pointer; transition: 0.2s; overflow: hidden; }
        .game-card:hover { transform: scale(1.05); }
        .game-img { width: 100%; height: 150px; background: #3a8e3a; display: flex; align-items: center; justify-content: center; font-size: 50px; }
        .game-info { padding: 15px; color: white; }

        /* MENU PAUZY (ESC) */
        #esc-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); display: none; 
            flex-direction: column; align-items: center; justify-content: center; z-index: 300;
        }
        .esc-box { background: #2B2D2F; padding: 30px; border-radius: 10px; width: 300px; display: flex; flex-direction: column; gap: 10px; }
        .esc-btn { padding: 15px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; font-size: 16px; }
        .btn-resume { background: #555; }
        .btn-reset { background: #F64141; }
        .btn-leave { background: #00A2FF; }

        #ui { position: absolute; bottom: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 8px; border-radius: 5px; display: none; pointer-events: none; }
    </style>
</head>
<body>

<div id="main-menu">
    <div class="header">ROBLOX</div>
    <div style="color: white; margin-top: 20px;">
        Wybierz Avatar: 
        <button onclick="gender='boy'" style="background: #00A2FF; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Ch≈Çopak</button>
        <button onclick="gender='girl'" style="background: #FF69B4; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Dziewczyna</button>
    </div>
    <div class="game-card" onclick="startGame()">
        <div class="game-img">üå≥</div>
        <div class="game-info">
            <b>Baseplate Adventure</b><br>
            <span style="font-size: 12px; color: #aaa;">Graj teraz</span>
        </div>
    </div>
</div>

<div id="esc-menu">
    <div class="esc-box">
        <h2 style="color: white; margin: 0 0 10px 0; text-align: center;">Settings</h2>
        <button class="esc-btn btn-resume" onclick="toggleEscMenu()">Resume</button>
        <button class="esc-btn btn-reset" onclick="resetCharacter()">Reset Character</button>
        <button class="esc-btn btn-leave" onclick="leaveGame()">Leave</button>
    </div>
</div>

<div id="ui">Naci≈õnij <b>ESC</b> dla menu</div>

<script type="importmap">
  { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
</script>

<script type="module">
    import * as THREE from 'three';

    window.gender = 'boy';
    let gameActive = false;
    let escOpen = false;
    let player, scene, camera, renderer, velocityY = 0, isJumping = false;
    const keys = {};

    window.startGame = () => {
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('ui').style.display = 'block';
        gameActive = true;
        initGame();
    };

    window.toggleEscMenu = () => {
        if (!gameActive) return;
        escOpen = !escOpen;
        document.getElementById('esc-menu').style.display = escOpen ? 'flex' : 'none';
    };

    window.resetCharacter = () => {
        player.position.set(0, 5, 0); // Spada z g√≥ry przy resecie
        velocityY = 0;
        toggleEscMenu();
    };

    window.leaveGame = () => {
        location.reload(); // Najprostszy spos√≥b na powr√≥t do menu
    };

    // Nas≈Çuchiwanie klawisza ESC
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Escape') toggleEscMenu();
        keys[e.code] = true;
        if(e.code === 'Space' && !isJumping && gameActive && !escOpen) {
            velocityY = 0.25;
            isJumping = true;
        }
    });
    window.addEventListener('keyup', (e) => keys[e.code] = false);

    function initGame() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);

        const floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshPhongMaterial({ color: 0x3a8e3a }));
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // BUDOWA POSTACI
        player = new THREE.Group();
        const skinCol = window.gender === 'boy' ? 0xffff00 : 0xffdbac;
        const torsoCol = window.gender === 'boy' ? 0x0000ff : 0xff69b4;
        
        const torso = new THREE.Mesh(new THREE.BoxGeometry(1, 1.2, 0.6), new THREE.MeshPhongMaterial({color: torsoCol}));
        torso.position.y = 1.2; player.add(torso);
        
        const head = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.7, 0.7), new THREE.MeshPhongMaterial({color: skinCol}));
        head.position.y = 2.15; player.add(head);

        // Twarz
        const eye = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.05), new THREE.MeshBasicMaterial({color: 0}));
        const eL = eye.clone(); eL.position.set(-0.2, 2.25, 0.36); player.add(eL);
        const eR = eye.clone(); eR.position.set(0.2, 2.25, 0.36); player.add(eR);
        const mouth = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.05, 0.05), new THREE.MeshBasicMaterial({color: 0}));
        mouth.position.set(0, 2.05, 0.36); player.add(mouth);

        scene.add(player);
        animate();
    }

    let walkTime = 0;
    function animate() {
        requestAnimationFrame(animate);
        if (gameActive && !escOpen) {
            const moveDir = new THREE.Vector3();
            let isMoving = false;

            if (keys['KeyW']) { moveDir.z = -1; isMoving = true; }
            if (keys['KeyS']) { moveDir.z = 1; isMoving = true; }
            if (keys['KeyA']) { moveDir.x = -1; isMoving = true; }
            if (keys['KeyD']) { moveDir.x = 1; isMoving = true; }

            if (isMoving) {
                moveDir.normalize();
                player.position.addScaledVector(moveDir, 0.15);
                player.rotation.y = Math.atan2(moveDir.x, moveDir.z);
                walkTime += 0.2;
                // Tutaj mo≈ºna dodaƒá animacjƒô rƒÖk (armL.rotation.x itp.)
            }

            player.position.y += velocityY;
            if (player.position.y > 0) velocityY -= 0.012;
            else { player.position.y = 0; velocityY = 0; isJumping = false; }

            camera.position.set(player.position.x, player.position.y + 6, player.position.z + 12);
            camera.lookAt(player.position.x, player.position.y + 1.5, player.position.z);
        }
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
